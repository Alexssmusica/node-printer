# appveyor file

# build version format
version: "{build}"

platform:
  - x86
  - x64

image: Visual Studio 2017

# Set a known clone folder
clone_folder: c:\p

# fix lineendings in Windows
init:
  - git config --global core.autocrlf input
  - git config --global user.name "Eko Eryanto"
  - git config --global user.email ekoeryanto@gmail.com

environment: 
  UTO:
    secure: LCgKqXmOMGn//dRIygDqFdZY2SRk+sPWBX5rHxSWbO8ORW59m8PtxJu9hfq/fHEI
  matrix:
    - PREBUILD_RUNTIME: 'electron'
    - PREBUILD_RUNTIME: 'node'
    - PREBUILD_RUNTIME: 'node-webkit'

matrix:
  fast_finish: true

install:
  - ps: Install-Product node 12
  - cmd: SET PATH=c:\python27;%PATH%
  - cmd: SET JOBS=4
  - cmd: SET BUILD_ONLY=true
  - cmd: npm ci --build-from-source
  - cmd: echo "Building for %PREBUILD_RUNTIME%"
  - cmd: npx prebuild --strip -r %PREBUILD_RUNTIME% -t 5.0.0 -u %UTO%
  - cmd: npx prebuild --strip -r %PREBUILD_RUNTIME% -t 6.0.0 -u %UTO%

test_script:
  - node --version
  - npm --version

build: off

branches:
  only:
    - release

cache:
  - '%APPDATA%\npm-cache'
  - '%USERPROFILE%\.node-gyp'