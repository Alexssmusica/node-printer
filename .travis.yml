env:
  matrix:
    - export NODE_VERSION="0.10"
    - export NODE_VERSION="0.12"
    - export NODE_VERSION="4"
    - export NODE_VERSION="5"
    - export NODE_VERSION="6"
    - export NODE_VERSION="8"
    - export NODE_VERSION="10"
    - export NODE_VERSION="11"
    - export NODE_VERSION="12"
matrix:
  fast_finish: true
  allow_failures:
    - env: NODE_VERSION="0.10"
    - env: NODE_VERSION="0.12"
before_install:
  - git clone https://github.com/creationix/nvm.git ./.nvm
  - source ./.nvm/nvm.sh
  - nvm install 12 64
  - nvm use 12
  - npm -v
  - node -v
  - if [ $TRAVIS_OS_NAME == "linux" ]; then
      sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test;
      sudo apt-get -qq update;
      sudo apt-get -qq install g++-4.8;
      export CXX='g++-4.8';
      sudo apt-get install -qq debhelper autotools-dev cups-ppdc libcups2-dev cups imagemagick ghostscript;
    fi
  - "export JOBS=4"
  - npm install -g node-gyp node-pre-gyp
  - BUILD_ONLY=true npm install --build-from-source
before_script:
  - git config --global user.name "Ion Lupascu"
  - git config --global user.email ionlupascu@gmail.com

after_script:
  - node-pre-gyp configure --target=$NODE_VERSION
  - node-pre-gyp build package --target=$NODE_VERSION --target_arch=x64

  - node-pre-gyp configure --target=$NODE_VERSION
  - node-pre-gyp build package --target=$NODE_VERSION --target_arch=ia32
  - npm test

# Need S3 Upload for Artifacts
# addons:
#   artifacts:
#     debug: true
#     paths:
#     - ./build/stage/**/*.tar.gz

git:
  depth: 1
branches:
  only:
    - master

os:
  - linux
  - osx
script: npm test
